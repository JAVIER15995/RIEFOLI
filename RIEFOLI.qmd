---
title: "RIEFOLI"
author: "Javier Gonzalez Canales"
format: html
editor: visual
---

## RIEFOLI

El IMIDRA está llevando a cabo el proyecto RIEFOLI en un olivar intensivo en la finca experimental "La chimenea", (Aranjuez-Colmenar de oreja). En este se proyecto se combina el uso de cuatro tramientos de cubiertas vegetales: (Cubierta de graminea (Brachipodium), Cubierta de leguminosas (Yeros), Cubierta vegetal espontánea y laboreo), con cuatro dosis de riego, (Riego completo (cubriendo las necesidades hidricas del árbol), Riego deficitario controlado, (Redución al 70% la dosis de riego completo, en un momento fenologico determinado), Riego soporte (Un aporte de 1500m3/año distribuidos a lo largo de la campaña de verano) y secano. En este proyecto se estudian los cambios en las propiedades fisico-quimicas (Materia orgánica, Calcimetría, analisis de macro y micro elementos del suelo, contenido de agua del suelo textura, porosidad, infiltración, resistencia a la pentetración....) microbiológicas (respiración basal del suelo, actividad enzimática, abundancia de Hongos, bacterias y arqueas). En el arbol se mide estrés hídrico, fotosísntesis, anchura de tronco, floración, maduración del fruto y produción de aceitunas. Tambien se elaborará aceite donde se medirá la producción industrial de aceite, el contenido en polifenoles y el contenido en pigmentos. En este trabajo se quiere relaccionar el contenido en polifenoles y la producción de aceitunas (Variables numéricas), con los diferentes tratamientos de riego y cubierta (Varialbes categóricas) ..

```{r}
#Cargamos los datos de excel

library(readxl)
library(tidyverse)
library(tidyr)
library(maps)
library(pacman)
pacman::p_load(here, easyclimate, patchwork, viridis, ggmisc, fs, future, furrr, rmarkdown) 
library(remotes)
library(easyclimate)

polif <- read_delim(file = here("DATOS", "polifenoles.csv"), delim = ";")
produ<- read_delim(file = here("DATOS", "produccion.csv"), delim = ";")

names(polif)

```

Hacemos los datos tidy (ya están)

Para saber el total de kg de aceitunas se cogieron así como la media, minimo, máximo y desviación de estandar de los Kg cogidos en cada árbol...

```{r}
Kg <- glimpse(produ$Produccion)

mean(produ$Produccion)
sum(produ$Produccion)
sd(produ$Produccion)
```

Hago una exploración gráfica para ver si hay outlayers

```{r}
library(ggplot2)
names(polif)

ggplot() + 
  geom_point(data = polif, aes(x =UdExp, y = Polifenoles)) 

ggplot() + 
  geom_point(data = polif, aes(x = as.factor(Riego), y = Polifenoles))

ggplot() + 
  geom_point(data = polif, aes(x = as.factor(Riego), y = Polifenoles, color = Cubierta))

ggplot() + 
  geom_point(data = produ, aes(x = as.factor(Riego), y = Produccion, color = Cubierta))          
names(produ)

```

He visto que los tratamientos estaban mál en la tabla, lo corrijo en excel, y vuelvo a correr el scritp para refrescar la info.

Hago las medias y desvest de las repeticiones de campo o laboratorio para tener un unico dato por unidad experimental

```{r}
mean_polif <- polif |>
  group_by(UdExp) |>
  summarise(mean_polif= mean(Polifenoles), sd_polif = sd(Polifenoles))


names(polif)

mean_produ <- produ |>
  group_by(Bloque, UdExp, Riego, Cubierta) |>
  summarise(mean_produc= mean(Produccion), sd_produ = sd(Produccion))
```

Ahora fusiono ambas tablas

```{r}

riefoli <-full_join(mean_produ, mean_polif, by =c("UdExp"))

Riefoli_trat <- riefoli |> 
  unite(trat, c(Riego, Cubierta), remove = FALSE, sep = "_")
```

Creo una nueva columna de tratamiento uniendo riego y cubierta

```{r}
names (Riefoli_trat)

ggplot() + 
  geom_point(data =Riefoli_trat , aes(x = as.factor(Cubierta), y = mean_polif, color = Riego))
ggplot() + 
  geom_point(data = Riefoli_trat, aes(x = as.factor(Cubierta), y = mean_produc, color =Riego))      
names(produ)
ggplot() + 
  geom_point(data = Riefoli_trat, aes(x = as.factor(trat), y = mean_produc, color =Riego))      

names(Riefoli_trat)
```

Pruebas gráficos

```{r}
summary(Riefoli_trat)
str (Riefoli_trat)



ggplot(data = Riefoli_trat, aes(x =as.factor(Riego), y = mean_produc, fill = Riego)) +
  geom_boxplot()
ggplot(data = Riefoli_trat, aes(x =as.factor(Cubierta), y = mean_produc, fill = Cubierta)) +
  geom_boxplot()

ggplot(data = Riefoli_trat, aes(x =as.factor(Riego), y = mean_polif, fill = Riego)) +
  geom_boxplot()

ggplot(data = Riefoli_trat, aes(x =as.factor(Cubierta), y = mean_polif, color = Riego)) +
  geom_point( size= 4 )+
  geom_errorbar(aes(ymax = mean_polif + sd_polif, ymin = mean_polif - sd_polif), width = 0.25)


ggplot(data = polif , aes(x =as.factor(Cubierta), y = Polifenoles, color = Riego)) +
  geom_boxplot()
  geom_errorbar(aes(ymax = mean_polif + sd_polif, ymin = mean_polif - sd_polif), width = 0.25)
  
  ggplot(data = polif , aes(x =as.factor(Cubierta), y = Polifenoles)) +
    geom_boxplot()
  geom_errorbar(aes(ymax = mean_polif + sd_polif, ymin = mean_polif - sd_polif), width = 0.25)
  
  ggplot(data = polif , aes(x =as.factor(Riego), y = Polifenoles)) +
    geom_boxplot()
  geom_errorbar(aes(ymax = mean_polif + sd_polif, ymin = mean_polif - sd_polif), width = 0.25)


geom_errorbar(aes(ymax = mean_produc + sd_produ, ymin = mean_produc), width = 0.25)

ggplot(data = Riefoli_trat, aes(x =as.factor(trat), y = mean_polif)) +
  geom_col(color = "black") +
  geom_errorbar(aes(ymax = mean_polif + sd_polif, ymin = mean_polif), width = 0.25)

##Hacer esto mismo con producción

ggplot(data = Riefoli_trat) + 
  geom_violin(aes(x = as.factor(trat), y =mean_polif  , fill = Cubierta), draw_quantiles = 0.5) 



```
